# prediction_client_banks_arrival

# Проект: ЗАДАЧА ПРЕДСКАЗАНИЯ ОТТОКА КЛИЕНТОВ БАНКА

### Оглавление

[Описание проекта](#описание-проекта) 

[Этапы проекта](#этапы-проекта)  

[Структура проекта](#структура-проекта)  

[Используемые библиотеки](#используемые-библиотеки) 

[Выводы](#выводы) 

[Установка и использование](#установка-и-использование)  

### ***Описание проекта***
Банк хочет разработать кампанию лояльности по удержанию клиентов. Для этого ему необходимо прогнозировать вероятности оттока клиентов и определять, уйдёт ли клиент в ближайшее время.
Задача -  построить классификатор, который позволит своевременно определять уходящих клиентов банка, оценить качество построенных моделей и проинтерпретировать результаты.

***Признаки и доступные данные для проекта.***

Значения столбцов таблицы:

* RowNumber — номер строки таблицы;
* CustomerId — идентификатор клиента;
* Surname — фамилия клиента;
* CreditScore — кредитный рейтинг клиента (чем он выше, тем больше клиент брал кредитов и возвращал их);
* Geography — страна проживания клиента (банк межнациональный);
* Gender — пол клиента;
* Age — возраст клиента;
* Tenure — сколько лет клиент пользуется банком;
* Balance — сколько у клиента денег на счетах в банке;
* NumOfProduct — число услуг банка, которыми воспользовался клиент;
* HasCrCard — есть ли у клиента кредитная карта (1 — да, 0 — нет);
* IsActiveMember — есть ли у клиента статус «активный клиент» (1 — да, 0 — нет);
* EstimatedSalary — предполагаемая заработная плата клиента;
* Exited — статус ушедшего (1 — ушедший клиент, 0 — лояльный клиент).

:arrow_up:[к оглавлению](#оглавление)

### Этапы проекта

Проект включает в себя несколько этапов, каждый из которых будет проанализирован и оформлен в Jupyter Notebook:

1. **Изучение и подготовка данных.**

   * Изучение структуры данных и признаков. Заполнение пропусков в данных, предподготовка признаков для последующего анализа.
     
2. **Работа с признаками:**
   
   * Знаковмство с признаками: изучение распределения значений, статистических показателей, выбросов, а также влияния каждого признака на целевой признак.
   * Выделение новых признаков: создание новых признаков на основе рассматриваемого на этом этапе и оценка их влияния на целевую переменную.
   * Принятие решения о включение признака для обучения модели: проведение корреляционнного и статистического анализа.
     
3. **Кодировка категориальных признаков.**
   
   * Для категориальных признаков будет проведена кодировка.
     
4. **Оценка влияния отобранных признаков на целевую переменную, а также изучение корреляции между признаками.**
   
   * Построение корреляционной матрицы для всех признаков.
   * Исключение признаков с высокой корреляцией между собой.
   * Оценка значимости влияния признаков на целевую переменную и отбор самых важных
  
5. **Обучение модели.**

   1. Обучение модели логистической регрессии и подбор оптимальных параметров для модели.
   2. Обучение модели логистической регрессии с полиномиальными признаками и подбор оптимальных параметров модели.
   3. Обучение модели дерева решений и подбор оптимальных значений модели.
   4. Обучение модели случайного леса и подбор оптимальных параметров.
   5. Поиск оптимального порого вероятности для лучших моделей.
     
6. **Оценка модели.**
   
    После обучения каждой модели будут проведены тесты для оценки ее точности и качества предсказаний.
   
7. **Предсказание на тестовой выборке**
   
   В конце проекта выполним тестовое предсказание на тестовой выборке.

   
:arrow_up:[к оглавлению](#оглавление)

### ***Структура проекта***

- [Prediction_client_banks_arrival.ipynb](https://github.com/Twi1ightFox/prediction_client_banks_arrival/blob/master/Prediction_client_banks_arrival.ipynb): Jupyter ноутбук итогового проекта.
- [Предсказание_ухода_клиента_банка.ipynb](https://github.com/Twi1ightFox/prediction_client_banks_arrival/blob/master/%D0%9F%D1%80%D0%B5%D0%B4%D1%81%D0%BA%D0%B0%D0%B7%D0%B0%D0%BD%D0%B8%D0%B5_%D1%83%D1%85%D0%BE%D0%B4%D0%B0_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0_%D0%B1%D0%B0%D0%BD%D0%BA%D0%B0.ipynb): Jupyter ноутбук согласно шаблону для сдачи итогового проекта.
- [README.md](https://github.com/Twi1ightFox/prediction_client_banks_arrival/blob/master/README.md): Описание проекта.
- [requirements.txt](https://github.com/Twi1ightFox/prediction_client_banks_arrival/blob/master/requirements.txt): Файл с зависимостями
- [Графики](https://github.com/Twi1ightFox/prediction_client_banks_arrival/tree/master/graphs): Папка с графиками

:arrow_up:[к оглавлению](#оглавление)

### Используемые библиотеки

Для работы с проектом потребуется установить следующие библиотеки:

* numpy - для матричных вычислений
* pandas - для анализа и предобработки данных
* matplotlib.pyplot as plt  - для визуализации
* seaborn - для визуализации
* GridSearchCV  - для поиска по сетке
* linear_model  - для линейных моделей
* StandardScaler - для масштабирования данных
* stats - расчет статистических показателей
* и другие библиотеки, указанные в файле requirements
:arrow_up:[к оглавлению](#оглавление)


### Выводы:

## При обучении на таких признаках:

*Исходные:*
1. 'CreditScore'
2. 'Age'
3. 'Balance'
4. 'HasCrCard'
2. 'IsActiveMember'
3. 'EstimatedSalary'

*Новые признаки:*
1. 'BalanceSalaryRatio'
2. 'TenureByAge'
3. 'CreditScoreGivenAge'
4. 'Gender_Male'

**Логистическая регрессия дала:**
* F1 score: 0.52 тренировочные данные
* F1 score: 0.50 тестовые данные

После подбора оптимальных параметров(C = 0.1, class_weight = 'balanced', penalty = 'l2', solver = 'liblinear')

F1 score с лучшей моделью: 0.60
F1 score с лучшей моделью: 0.58

**С полиномиальными признаками третьей степени:**
* F1 score: 0.51 тренировочные данные
* F1 score: 0.48 тестовые данные

**С полиномиальными признаками второй степени:**
* F1 score: 0.51 тренировочные данные
* F1 score: 0.49 тестовые данные

После подбора оптимальных параметров(C = 10, class_weight = 'balanced', penalty = 'l1', solver = 'liblinear')
* F1 score: 0.69 тренировочные данные
* F1 score: 0.69 тестовые данные

После выбора оптимального порога вероятности 0.6, F1 scorе стала на уровне 0.66. Максимальный скор наблюдается при пороге в 0.5

**Дерево решений**
* F1 score: 1.00 тренировочные данные
* F1 score: 0.54 тестовые данные

С параметрами max_depth = 8, min_samples_leaf = 10

* F1 score: 0.72 тренировочные данные
* F1 score: 0.66 тестовые данные

С подбором оптимальных параметров (max_depth = 11, min_samples_leaf = 9):
* F1 score: 0.78 тренировочные данные
* F1 score: 0.66 тестовые данные

**Случайный лес**

Параметры(n_esminators = 500, max_depth = 8, min_samples_leaf = 10)
* F1 score: 0.74 тренировочные данные
* F1 score: 0.64 тестовые данные

После подбора оптимальных параметров(n_esminators = 500, max_depth = 6, min_samples_leaf = 10)
* F1 score: 0.70
* F1 score: 0.67

Попробуем сместить порог вероятности (0.4) для случайного леса F1 score стал равен 0.69

**Итоговое предсказание**

* Вероятность того, что клиент перестанет быть лояльным - [0.5716376]
* Прогнозируемый класс Exited нового клиента = [1]

**При данных признаках лучшими моделью стал случайный лес с порогом вероятности 0.4**


## При обучении на таких признаках:

*Исходные:*
1. 'CreditScore'
2. 'IsActiveMember'
3. 'EstimatedSalary'

*Новые признаки:*
1. 'BalanceSalaryRatio'
2. 'TenureByAge'
3. 'CreditScoreGivenAge'
4. 'Gender_Male'
5. 'NumOfProducts_2'
6. 'NumOfProducts_3'
7. 'NumOfProducts_4'
8. 'AgeBetween18And41'
9. 'AgeBetween42And47'
10. 'AgeBetween48And65'
11. 'AgeMore65'

**Логистическая регрессия дала:**
* F1 score: 0.66 тренировочные данные
* F1 score: 0.63 тестовые данные

После подбора оптимальных параметров(C = 1, class_weight = 'balanced', penalty = 'l2', solver = 'liblinear')

F1 score с лучшей моделью: 0.68
F1 score с лучшей моделью: 0.68

**С полиномиальными признаками третьей степени:**
* F1 score: 0.72 тренировочные данные
* F1 score: 0.64 тестовые данные

**С полиномиальными признаками второй степени:**
* F1 score: 0.68 тренировочные данные
* F1 score: 0.65 тестовые данные

После подбора оптимальных параметров(C = 10, class_weight = 'balanced', penalty = 'l1', solver = 'liblinear')
* F1 score: 0.69 тренировочные данные
* F1 score: 0.69 тестовые данные

После выбора оптимального порога вероятности 0.6, F1 score также стала на уровне 0.66. Максимальный скор наблюдается при пороге в 0.5

**Дерево решений**
* F1 score: 1.00 тренировочные данные
* F1 score: 0.54 тестовые данные

С параметрами max_depth = 8, min_samples_leaf = 10

* F1 score: 0.72 тренировочные данные
* F1 score: 0.57 тестовые данные

С подбором оптимальных параметров (max_depth = 3, min_samples_leaf = 1):
* F1 score: 0.66 тренировочные данные
* F1 score: 0.64 тестовые данные

**Случайный лес**

Параметры(n_esminators = 500, max_depth = 8, min_samples_leaf = 10)
* F1 score: 0.69 тренировочные данные
* F1 score: 0.62 тестовые данные

После подбора оптимальных параметров(n_esminators = 500, max_depth = 8, min_samples_leaf = 1)
* F1 score: 0.74
* F1 score: 0.64

Попробуем сместить порог вероятности (0.57) для логистической регрессии без полиномиальных признаков F1 score стал равен 0.67

**Итоговое предсказание**

**Логистическая регрессия*

* Вероятность того, что клиент перестанет быть лояльным - [0.78823355]
* Прогнозируемый класс Exited нового клиента = [1]

**Логистическая регрессия с полиномиальными признаками*

* Вероятность того, что клиент перестанет быть лояльным - [0.8235577]
* Прогнозируемый класс Exited нового клиента = [1]

**При данных признаках лучшими моделями стали логистическая регрессия и логистическая регрессия с полиномиальными признаками. Обе эти модели дали самые высокие значения F1 score, а также обе модели предсказали то, что клиент скорее всего откажется от услуг банка**

**Для более точного результата итоговую вероятность ухода клиента можно получить путем объединения результатов обеих моделей. Самый простой вариант взять среднее от 2х вероятностей (0.8058956)*

:arrow_up:[к оглавлению](#оглавление)

### Установка и использование

1. Клонируйте репозиторий:
   git clone [https://github.com/Twi1ightFox/prediction_client_banks_arrival.git](https://github.com/Twi1ightFox/prediction_client_banks_arrival)
   
2. Установите нужные версии библиотек:
   
   pip install -r requirements.txt
   
3. Запустить Jupyter notebook для просмотра и запуска анализа.

:arrow_up:[к оглавлению](#оглавление)
